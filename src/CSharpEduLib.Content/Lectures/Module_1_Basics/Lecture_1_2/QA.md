# Лекция 1.2 — Контроль качества и частые ошибки

Этот документ содержит частые ошибки новичков, контрольные вопросы и практические задания по материалу лекции 1.2.

## Частые ошибки

### 1. Parse vs TryParse

**Неправильно:**
```csharp
string input = Console.ReadLine();
int number = int.Parse(input); // Может вызвать исключение!
```

**Правильно:**
```csharp
string input = Console.ReadLine();
if (int.TryParse(input, out int number))
{
    Console.WriteLine($"Число: {number}");
}
else
{
    Console.WriteLine("Ошибка ввода");
}
```

**Ошибка:** Использование `Parse` без обработки исключений может привести к аварийному завершению программы.

### 2. Округление чисел с плавающей точкой

**Неправильно:**
```csharp
double result = 7.0 / 3.0;
Console.WriteLine(result); // Выведет: 2.3333333333333335
```

**Правильно:**
```csharp
double result = 7.0 / 3.0;
Console.WriteLine($"{result:F2}"); // Выведет: 2.33
Console.WriteLine(Math.Round(result, 2)); // Выведет: 2.33
```

**Ошибка:** Неумение контролировать количество знаков после запятой при выводе.

### 3. Приведения типов

**Неправильно:**
```csharp
double d = 9.7;
int i = d; // Ошибка компиляции!
```

**Правильно:**
```csharp
double d = 9.7;
int i = (int)d; // Явное приведение, i = 9 (отбрасывает дробную часть)
int i2 = Convert.ToInt32(d); // i2 = 10 (округляет)
int i3 = (int)Math.Round(d); // i3 = 10 (округляет, затем приводит)
```

**Ошибка:** Непонимание разницы между явным приведением, Convert и Math.Round.

### 4. Интернациональные разделители

**Неправильно:**
```csharp
// На системах с русской локалью может возникнуть проблема
double number = double.Parse("3.14"); // Ошибка, если система ожидает запятую
```

**Правильно:**
```csharp
using System.Globalization;

// Использование инвариантной культуры
double number = double.Parse("3.14", CultureInfo.InvariantCulture);

// Или использование TryParse с культурой
if (double.TryParse("3.14", NumberStyles.Float, CultureInfo.InvariantCulture, out double result))
{
    Console.WriteLine($"Число: {result}");
}
```

**Ошибка:** Игнорирование локализации может привести к неправильной работе программы.

### 5. Неинициализированные переменные

**Неправильно:**
```csharp
int x;
Console.WriteLine(x); // Ошибка компиляции: переменная не инициализирована
```

**Правильно:**
```csharp
int x = 0; // Явная инициализация
Console.WriteLine(x);

// Или
int y;
if (int.TryParse(Console.ReadLine(), out y))
{
    Console.WriteLine(y); // Теперь y гарантированно инициализирована
}
```

**Ошибка:** Попытка использовать переменную до ее инициализации.

### 6. Неправильное сравнение чисел с плавающей точкой

**Неправильно:**
```csharp
double a = 0.1 + 0.2;
if (a == 0.3) // Может быть false из-за ошибок округления!
{
    Console.WriteLine("Равны");
}
```

**Правильно:**
```csharp
double a = 0.1 + 0.2;
double epsilon = 1e-9;
if (Math.Abs(a - 0.3) < epsilon) // Сравнение с толерантностью
{
    Console.WriteLine("Примерно равны");
}
```

**Ошибка:** Прямое сравнение чисел с плавающей точкой может дать неожиданные результаты.

## Контрольные вопросы

### Базовые вопросы

1. **Какая разница между `Parse` и `TryParse`?**
   - `Parse` вызывает исключение при ошибке, `TryParse` возвращает `bool`

2. **Какие типы данных нужно явно приводить при присваивании?**
   - От большего к меньшему (например, `double` к `int`)

3. **Как правильно округлить число до 2 знаков после запятой?**
   - `Math.Round(number, 2)` или `{number:F2}`

4. **Почему сравнение `0.1 + 0.2 == 0.3` может дать `false`?**
   - Ошибки округления в числах с плавающей точкой

5. **Как обеспечить работу с дробными числами на разных языковых средах?**
   - Использовать `CultureInfo.InvariantCulture`

### Продвинутые вопросы

6. **Что происходит при переполнении типа `int`?**
   - Переполнение приводит к циклическому возврату к минимальному значению

7. **В чем разница между `(int)` и `Convert.ToInt32()`?**
   - `(int)` отбрасывает дробную часть, `Convert.ToInt32()` округляет

8. **Какое значение по умолчанию у типов `int`, `double`, `bool`, `string`?**
   - `int`: 0, `double`: 0.0, `bool`: false, `string`: null

## Практические задания

### Задание 1: Безопасный калькулятор
Напишите программу, которая:
1. Запрашивает два числа
2. Проверяет корректность ввода с `TryParse`
3. Выводит все арифметические операции
4. Обрабатывает деление на ноль

### Задание 2: Конвертер типов
Создайте программу, которая демонстрирует:
1. Явное приведение `(int)` для `double` 9.7
2. Преобразование `Convert.ToInt32()` для того же числа
3. Округление `Math.Round()` до приведения

### Задание 3: Округление и форматирование
Напишите программу, которая:
1. Вычисляет пи (используйте `Math.PI`)
2. Выводит его с разным количеством знаков: 0, 2, 5, 10
3. Показывает разницу между `Math.Round()` и форматированием `F2`

### Задание 4: Мультиязыковый парсер
Создайте программу, которая:
1. Парсит число "3,14" (русский формат)
2. Парсит число "3.14" (английский формат)
3. Использует `CultureInfo.InvariantCulture` для надёжности

### Задание 5: Проверка равенства double
Напишите функцию, которая:
1. Принимает два `double` числа
2. Возвращает `true`, если они равны с точностью до 1e-9
3. Проверяет на примере 0.1 + 0.2 и 0.3

## Проверочные тесты

### Тест 1: Ошибки компиляции
Найдите ошибки в следующем коде:
```csharp
int x;
double y = 5.5;
x = y;
Console.WriteLine(x);
```

### Тест 2: Логические ошибки
Что выведет этот код?
```csharp
double result = 0.1 + 0.2;
Console.WriteLine(result == 0.3);
Console.WriteLine(result);
```

### Тест 3: Приведение типов
Какие значения получат переменные?
```csharp
double d = 9.7;
int a = (int)d;
int b = Convert.ToInt32(d);
int c = (int)Math.Round(d);
```

### Ответы:

**Тест 1:** Ошибки - неинициализированная переменная `x` и неявное преобразование `double` к `int`.

**Тест 2:** Первая строка выведет `False`, вторая - `0.30000000000000004` (или похожее).

**Тест 3:** `a = 9` (отброс), `b = 10` (округлит), `c = 10` (округлит, потом приведёт).

## Рекомендации по качеству кода

### 1. Всегда используйте TryParse
Когда пользователь вводит данные, всегда используйте `TryParse` вместо `Parse`.

### 2. Контролируйте формат вывода
Не полагайтесь на стандартное форматирование `double` - явно указывайте количество знаков.

### 3. Обрабатывайте краевые случаи
Всегда проверяйте деление на ноль, переполнение и другие специальные случаи.

### 4. Пишите читаемый код
Используйте осмысленные имена переменных и комментарии для сложных вычислений.

### 5. Тестируйте на разных системах
Проверяйте программы на системах с разными языковыми настройками.