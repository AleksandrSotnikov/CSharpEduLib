# Лекция 1.3 — Операторы и выражения

В этой лекции мы подробно изучим все типы операторов в C#, их приоритет, ассоциативность и особенности использования.

## Цели лекции

- Понять классификацию операторов в C#
- Освоить приоритет и ассоциативность операций
- Научиться работать с комбинированными операторами
- Получить обзор побитовых операций

## Классификация операторов

Операторы в C# можно классифицировать по нескольким критериям:

### 1. По количеству операндов

- **Унарные** (один операнд): `+x`, `-x`, `!x`, `++x`, `x++`
- **Бинарные** (два операнда): `x + y`, `x * y`, `x == y`
- **Тройные** (три операнда): `condition ? value1 : value2`

### 2. По назначению

1. **Арифметические**
2. **Сравнения**
3. **Логические**
4. **Побитовые**
5. **Присваивания**
6. **Прочие** (типов, доступа, условные)

## Арифметические операторы

### Унарные арифметические операторы

```csharp
int x = 5;

// Плюс (унарный)
int positive = +x; // 5 (обычно избыточен)

// Минус (унарный)
int negative = -x; // -5

// Префиксные инкремент и декремент
int a = 5;
int preIncrement = ++a; // a становится 6, preIncrement = 6
int preDecrement = --a; // a становится 5, preDecrement = 5

// Постфиксные инкремент и декремент
int b = 5;
int postIncrement = b++; // postIncrement = 5, затем b становится 6
int postDecrement = b--; // postDecrement = 6, затем b становится 5
```

### Бинарные арифметические операторы

```csharp
int a = 10, b = 3;

int sum = a + b;        // Сложение: 13
int difference = a - b; // Вычитание: 7
int product = a * b;    // Умножение: 30
int quotient = a / b;   // Целочисленное деление: 3
int remainder = a % b;  // Остаток от деления: 1

// Особенности деления
double floatDivision = (double)a / b; // 3.3333...
double integerDivision = a / b;       // 3.0 (сначала целочисленное деление)
```

### Особенности арифметики с разными типами

```csharp
// Целочисленное деление
int result1 = 7 / 3;      // 2 (отбрасывает дробную часть)

// Деление с плавающей точкой
double result2 = 7.0 / 3; // 2.333...
double result3 = 7 / 3.0; // 2.333...
double result4 = (double)7 / 3; // 2.333...

// Остаток от деления
int remainder1 = 10 % 3;   // 1
int remainder2 = -10 % 3;  // -1 (знак соответствует делимому)
int remainder3 = 10 % -3;  // 1

// Переполнение
int maxInt = int.MaxValue; // 2,147,483,647
int overflow = maxInt + 1; // -2,147,483,648 (переполнение без исключения)
```

## Операторы сравнения

```csharp
int a = 5, b = 3;

bool equal = (a == b);        // false (равенство)
bool notEqual = (a != b);     // true (неравенство)
bool greater = (a > b);       // true (больше)
bool less = (a < b);          // false (меньше)
bool greaterEqual = (a >= b); // true (больше или равно)
bool lessEqual = (a <= b);    // false (меньше или равно)

// Особенности сравнения строк
string str1 = "Hello";
string str2 = "Hello";
string str3 = "hello";

bool stringEqual1 = (str1 == str2); // true (сравнение содержимого)
bool stringEqual2 = (str1 == str3); // false (учитывает регистр)

// Особенности сравнения чисел с плавающей точкой
double d1 = 0.1 + 0.2;
double d2 = 0.3;
bool floatEqual = (d1 == d2); // Может быть false из-за ошибок округления
```

## Логические операторы

### Унарные логические операторы

```csharp
bool value = true;
bool negated = !value; // false (логическое НЕ)

// Примеры с выражениями
int x = 5;
bool isNotPositive = !(x > 0); // false, потому что x > 0 = true
bool isZeroOrNegative = !(x > 0); // то же самое
```

### Бинарные логические операторы

```csharp
bool a = true, b = false;

// Логическое И
bool and1 = a && b; // false (оба операнда должны быть true)
bool and2 = a & b;  // false (аналогично, но всегда вычисляет оба операнда)

// Логическое ИЛИ
bool or1 = a || b;  // true (достаточно одного true)
bool or2 = a | b;   // true (аналогично, но всегда вычисляет оба операнда)

// Исключающее ИЛИ
bool xor = a ^ b;   // true (только один из операндов true)
```

### Короткое вычисление (Short-circuit evaluation)

```csharp
int x = 5;
int y = 0;

// && - если первый операнд false, второй не вычисляется
bool result1 = (y != 0) && (x / y > 1); // false, деления не происходит

// || - если первый операнд true, второй не вычисляется
bool result2 = (x > 0) || (++y > 0); // true, y не увеличивается

// & и | всегда вычисляют оба операнда
bool result3 = (x > 0) | (++y > 0); // true, но y увеличивается на 1
```

## Приоритет и ассоциативность операторов

### Таблица приоритетов (от высшего к низшему)

| Приоритет | Операторы | Ассоциативность |
|------------|----------|-------------------|
| 1 (макс) | `()`, `[]`, `.`, `->`, `x++`, `x--` | Слева направо |
| 2 | `+x`, `-x`, `!x`, `~x`, `++x`, `--x`, `(type)x` | Справа налево |
| 3 | `*`, `/`, `%` | Слева направо |
| 4 | `+`, `-` (бинарные) | Слева направо |
| 5 | `<<`, `>>` | Слева направо |
| 6 | `<`, `>`, `<=`, `>=` | Слева направо |
| 7 | `==`, `!=` | Слева направо |
| 8 | `&` (побитовое) | Слева направо |
| 9 | `^` | Слева направо |
| 10 | `\|` (побитовое) | Слева направо |
| 11 | `&&` | Слева направо |
| 12 | `\|\|` | Слева направо |
| 13 | `? :` (тернарный) | Справа налево |
| 14 (мин) | `=`, `+=`, `-=`, `*=`, `/=`, `%=` | Справа налево |

### Примеры влияния приоритета

```csharp
// Приоритет операций
int result1 = 2 + 3 * 4;      // 14, а не 20 (сначала 3*4, потом +2)
int result2 = (2 + 3) * 4;    // 20 (скобки меняют порядок)

// Сравнения и логика
bool result3 = 5 > 3 && 2 < 4; // true && true = true
bool result4 = 5 > 3 && 2 > 4; // true && false = false

// Опасность: неправильное понимание приоритетов
bool dangerous = true || false && false; // true, потому что && имеет высший приоритет
bool clear = true || (false && false);   // true, то же самое, но яснее
```

### Ассоциативность

```csharp
// Левоассоциативные операторы (вычисляются слева направо)
int leftAssoc = 10 - 5 - 2; // (10 - 5) - 2 = 3
int division = 20 / 4 / 2;  // (20 / 4) / 2 = 2

// Правоассоциативные операторы (вычисляются справа налево)
int x = 1, y = 2, z = 3;
int rightAssoc = x = y = z; // x = (y = z) = x = (y = 3) = x = 3, результат: x=3, y=3, z=3

// Тернарный оператор тоже правоассоциативный
int ternary = true ? 1 : false ? 2 : 3; // true ? 1 : (false ? 2 : 3) = 1
```

## Комбинированные операторы присваивания

Комбинированные операторы позволяют выполнить операцию и сохранить результат в той же переменной.

### Арифметические комбинированные операторы

```csharp
int x = 10;

// Обычные операции
x = x + 5;  // x = 15
x = x - 3;  // x = 12
x = x * 2;  // x = 24
x = x / 4;  // x = 6
x = x % 4;  // x = 2

// Комбинированные операторы (короче и яснее)
int y = 10;
y += 5;  // y = y + 5 = 15
y -= 3;  // y = y - 3 = 12
y *= 2;  // y = y * 2 = 24
y /= 4;  // y = y / 4 = 6
y %= 4;  // y = y % 4 = 2

// Работа со строками
string message = "Hello";
message += ", World!"; // message = "Hello, World!"

// Особенность: возвращение значения
int a = 5;
int b = (a += 3); // a = 8, b = 8 (оператор возвращает новое значение)
```

### Логические комбинированные операторы

```csharp
bool flag = true;
flag &= false; // flag = flag & false = false
flag |= true;  // flag = flag | true = true
flag ^= true;  // flag = flag ^ true = false
```

### Побитовые комбинированные операторы

```csharp
int flags = 0b1010; // 10 в двоичной системе
flags &= 0b1100;    // flags = 0b1010 & 0b1100 = 0b1000 = 8
flags |= 0b0011;    // flags = 0b1000 | 0b0011 = 0b1011 = 11
flags ^= 0b1111;    // flags = 0b1011 ^ 0b1111 = 0b0100 = 4
flags <<= 2;        // flags = 0b0100 << 2 = 0b10000 = 16
flags >>= 1;        // flags = 0b10000 >> 1 = 0b1000 = 8
```

## Обзор побитовых операций

Побитовые операции работают на уровне отдельных битов в двоичном представлении числа.

### Основные побитовые операторы

```csharp
int a = 0b1010; // 10 в двоичной системе
int b = 0b1100; // 12 в двоичной системе

// Побитовое И (AND)
int and = a & b;    // 0b1010 & 0b1100 = 0b1000 = 8

// Побитовое ИЛИ (OR)
int or = a | b;     // 0b1010 | 0b1100 = 0b1110 = 14

// Побитовое исключающее ИЛИ (XOR)
int xor = a ^ b;    // 0b1010 ^ 0b1100 = 0b0110 = 6

// Побитовое НЕ (инверсия)
int not = ~a;       // ~0b1010 = 0b...11110101 (все биты инвертируются)

// Сдвиг влево (<<)
int leftShift = a << 2;  // 0b1010 << 2 = 0b101000 = 40 (умножение на 2^2)

// Сдвиг вправо (>>)
int rightShift = a >> 1; // 0b1010 >> 1 = 0b0101 = 5 (деление на 2^1)
```

### Практические применения побитовых операций

```csharp
// 1. Проверка четности/нечетности
int number = 15;
bool isEven = (number & 1) == 0;  // false (нечетное)
bool isOdd = (number & 1) == 1;   // true (нечетное)

// 2. Установка бита в определенной позиции
int flags = 0;
int position = 3;
flags |= (1 << position); // Установить 3-й бит

// 3. Проверка бита в определенной позиции
bool isBitSet = (flags & (1 << position)) != 0;

// 4. Очистка бита в определенной позиции
flags &= ~(1 << position); // Очистить 3-й бит

// 5. Инверсия бита в определенной позиции
flags ^= (1 << position); // Инвертировать 3-й бит
```

### Побитовые маски и флаги

```csharp
// Определение флагов через побитовые степени 2
const int READ = 1;    // 0b001
const int WRITE = 2;   // 0b010
const int EXECUTE = 4; // 0b100

// Комбинирование флагов
int permissions = READ | WRITE;           // 0b011 = 3
int fullAccess = READ | WRITE | EXECUTE; // 0b111 = 7

// Проверка наличия определенного разрешения
bool canRead = (permissions & READ) != 0;       // true
bool canExecute = (permissions & EXECUTE) != 0; // false

// Добавление разрешения
permissions |= EXECUTE; // Добавить право выполнения

// Удаление разрешения
permissions &= ~WRITE; // Убрать право записи
```

## Тройный (тернарный) оператор

Тройный оператор `? :` позволяет записать короткое условное выражение.

### Синтаксис

```
condition ? valueIfTrue : valueIfFalse
```

### Примеры использования

```csharp
int x = 10, y = 5;

// Простое условие
int max = (x > y) ? x : y; // 10

// Альтернатива через if-else
int maxIfElse;
if (x > y)
    maxIfElse = x;
else
    maxIfElse = y;

// Использование в выводе
int age = 18;
Console.WriteLine($"Вы {(age >= 18 ? "совершеннолетний" : "несовершеннолетний")}");

// Несколько условий (вложенные тернарные операторы)
int score = 85;
string grade = score >= 90 ? "A" : 
               score >= 80 ? "B" : 
               score >= 70 ? "C" : 
               score >= 60 ? "D" : "F";

// Осторожно: сложные выражения могут быть нечитаемыми
int complex = x > y ? (y > 0 ? x + y : x - y) : (y > 0 ? y - x : -(x + y));
```

## Оператор typeof и is

### typeof - получение типа

```csharp
Type intType = typeof(int);
Type stringType = typeof(string);
Type doubleType = typeof(double);

Console.WriteLine(intType.Name);     // "Int32"
Console.WriteLine(stringType.Name);  // "String"
```

### is - проверка типа

```csharp
object obj = "Hello";

bool isString = obj is string;  // true
bool isInt = obj is int;        // false

// Использование в условных конструкциях
if (obj is string str)
{
    Console.WriteLine($"Длина строки: {str.Length}");
}
```

## Практические рекомендации

### 1. Используйте скобки для ясности

```csharp
// Неясно
bool result = a && b || c && d;

// Ясно
bool result = (a && b) || (c && d);
```

### 2. Осторожность с плавающей арифметикой

```csharp
// Проблема: потеря точности
int a = 1, b = 3;
double result1 = a / b; // 0.0 (целочисленное деление)

// Решение: явное приведение
double result2 = (double)a / b; // 0.333...
```

### 3. Берегитесь переполнений

```csharp
// Потенциальное переполнение
int big = int.MaxValue;
int overflow = big + 1; // Молчаливое переполнение

// Проверка на переполнение
checked
{
    try
    {
        int safeResult = big + 1; // Выбросит OverflowException
    }
    catch (OverflowException)
    {
        Console.WriteLine("Произошло переполнение!");
    }
}
```

### 4. Правильное использование инкремента/декремента

```csharp
int[] array = {1, 2, 3, 4, 5};
int i = 0;

// Опасно: непонятное поведение
array[i] = ++i; 

// Лучше: ясное поведение
++i;
array[i] = i;
```

## Заключение

В этой лекции мы подробно рассмотрели:

1. **Классификацию операторов** - унарные, бинарные и тройные
2. **Приоритет и ассоциативность** - как определяется порядок вычисления
3. **Арифметические операторы** - основные математические операции
4. **Логические операторы** - работа с булевыми значениями
5. **Комбинированные операторы** - короткая запись операций с присваиванием
6. **Побитовые операции** - работа на уровне битов

Понимание операторов и их особенностей критически важно для написания корректных и эффективных программ на C#.